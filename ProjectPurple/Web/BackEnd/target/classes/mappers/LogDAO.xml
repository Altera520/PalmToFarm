<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org/DTD Config 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="log">
	<insert id="insertLog" parameterType="com.spring.smart_plant.log.domain.DeviceLogDTO">
		INSERT INTO DEVICE_LOG
		(USED_DT, SF_CODE, ACT_NAME, USED_IP, USED_RES)
		VALUES 
		(#{usedDate},#{sfCode},#{actName},#{usedIp},#{result})
	</insert>
	<select id="getLog" parameterType="com.spring.smart_plant.common.domain.DateSearchDTO"
	resultMap="logDto">
		SELECT * FROM DEVICE_LOG
		<!-- 부등호 태그를 인식하지 못하므로 CDATA를 추가해준다. -->
		<![CDATA[
		WHERE  USED_DT >= TO_DATE(#{date},'YYYY-MM-DD')
		AND USED_DT  < TO_DATE(#{date},'YYYY-MM-DD')+1
		AND SF_CODE=#{sfCode}
		]]>
		<!-- AND SF_CODE=#{sfCode} -->
	</select>
	
	<delete id="deleteAllLog" parameterType="String">
		DELETE FROM DEVICE_LOG L
 		WHERE
 		EXISTS (
        	SELECT SF_CODE 
        	FROM SF S,AP A
			WHERE S.AP_PUBLIC_IP=A.AP_PUBLIC_IP 
			AND A.AP_PUBLIC_IP=#{ip}
		)
	</delete>
	
	<delete id="deleteSingleLog" parameterType="Integer">
		DELETE FROM DEVICE_LOG
 		WHERE SF_CODE=#{sfCode}
	</delete>
	
	<resultMap type="com.spring.smart_plant.log.domain.DeviceLogDTO" id="logDto">
		<result property="usedDate" column="used_dt"/>
		<result property="sfCode" column="sf_code"/>
		<result property="actName" column="act_name"/>
		<result property="usedIp" column="used_ip"/>
		<result property="result" column="used_res"/>
	</resultMap>
</mapper>